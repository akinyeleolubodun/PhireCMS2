/**
 * Jax Form Module
 * Requires the Jax JavaScript Library 3.2.0
 *
 * @link       https://github.com/nicksagona/JaxModules/form
 * @version    1.0
 * @category   jax
 * @author     Nick Sagona, III <dev@nolainteractive.com>
 * @copyright  Copyright (c) 2009-2014 NOLA Interactive, LLC. (http://www.nolainteractive.com)
 * @license    http://www.jaxjs.org/license     New BSD License
 */
jax.extend({rules:[],validators:[],formId:null,errorDisplay:null,trace:null,form:function(a,b){return this.lang==null&&(this.lang=window.jax.i18n()),this.formId=this[0].id!=undefined?this[0].id:null,a!=undefined&&a!=null&&(this.rules=a),b!=undefined&&b!=null&&(this.trace=b),this},setErrorDisplay:function(a){return this.errorDisplay=a!=null&&a.color!=undefined?a:null,this},validate:function(){this.validators=[];var animateParams=[];this.parseElements();var trackErrors=[],errors={},htmlError=!1;for(var i=0;i<this.validators.length;i++){var error=this.isValid(this.validators[i]);if(this.validators[i][0]=="radio")var fo=eval("this[0].elements['"+this.validators[i][1]+"'][0]");else if(this.validators[i][0]=="checkbox"||this.validators[i][0]=="select-multiple")var fo=eval("this[0].elements['"+this.validators[i][1]+"'][0]");else var fo=eval("this[0].elements['"+this.validators[i][1]+"']");var foChildren=fo.parentNode.childNodes,parentNode=null;fo.parentNode!=null?parentNode=fo.parentNode:parentNode=this.parent();if(error!=null){fo.focus(),trackErrors.indexOf(this.validators[i][1])==-1&&(trackErrors.push(this.validators[i][1]),errors[this.validators[i][1]]=error),this.validators[i][0].indexOf("select")==-1&&fo.select();if(this.errorDisplay!=null)parentNode!=null&&foChildren[foChildren.length-1]!=undefined&&foChildren[foChildren.length-1].nodeName!="SPAN"&&(this.errorDisplay.bgColor!=undefined&&this.errorDisplay.orgColor!=undefined?(animateParams.push([parentNode,[["blendBgColor",{c1:this.errorDisplay.orgColor,c2:this.errorDisplay.bgColor}]]]),window.jax(parentNode).append("span",{"class":"jax-form-error",style:"color: "+this.errorDisplay.orgColor+"; font-weight: bold;"},error),animateParams.push([parentNode.childNodes[parentNode.childNodes.length-1],[["blendColor",{c1:this.errorDisplay.orgColor,c2:this.errorDisplay.color}]]])):this.errorDisplay.bgColor!=undefined?(window.jax(parentNode).append("span",{"class":"jax-form-error",style:"color: "+this.errorDisplay.color+"; font-weight: bold;"},error),window.jax(parentNode).css("background-color",this.errorDisplay.bgColor)):window.jax(parentNode).append("span",{"class":"jax-form-error",style:"color: "+this.errorDisplay.color+"; font-weight: bold;"},error)),htmlError=!0;else return alert(error),!1}else trackErrors.indexOf(this.validators[i][1])==-1&&foChildren[foChildren.length-1]!=undefined&&foChildren[foChildren.length-1].nodeName=="SPAN"&&(parentNode!=null&&window.jax(parentNode).css("background","transparent"),foChildren[foChildren.length-1]!=undefined&&window.jax(foChildren[foChildren.length-1]).remove())}this.trace!=null&&this.trace.apply(undefined,[this[0],errors]);if(trackErrors.length>0){var elem=trackErrors[0].indexOf("[")!=-1?trackErrors[0].substring(0,trackErrors[0].indexOf("[")):trackErrors[0];if(window.jax("#"+elem)[0]!=undefined)window.jax("#"+elem)[0].focus();else{var elemObj=eval("this[0]."+elem);elemObj!=null&&elemObj.focus()}}if(animateParams.length>0){var tween=this.errorDisplay.tween!=undefined?this.errorDisplay.tween:15,speed=this.errorDisplay.speed!=undefined?this.errorDisplay.speed:30,easingX=null,easingY=null;if(this.errorDisplay.easing!=undefined)var easingX=this.errorDisplay.easing,easingY=this.errorDisplay.easing;else if(this.errorDisplay.easingX!=undefined&&this.errorDisplay.easingY!=undefined)var easingX=this.errorDisplay.easingX,easingY=this.errorDisplay.easingY;window._test=animateParams,window.jax().animate(animateParams,{tween:tween,speed:speed,easingX:easingX,easingY:easingY})}return!htmlError},parseElements:function(){if(this.rules!=null)for(var fieldName in this.rules){var obj=eval("this[0].elements['"+fieldName+"']");if(obj==undefined)var fldName=fieldName.indexOf("[")!=-1?fieldName.substring(0,fieldName.indexOf("[")):fieldName+"[]",obj=eval("this[0].elements['"+fldName+"']");obj.nodeType==undefined&&(obj=obj[0]);var elemName=fieldName.indexOf("[")!=-1?fieldName.substring(0,fieldName.indexOf("[")):fieldName;elemName=elemName.replace(/_/g," ");for(var val in this.rules[fieldName]){var v=this.rules[fieldName][val];val=val.toLowerCase();var condVal=null,customMsg=null;val=="required"?(val="notempty",customMsg=v.constructor==String?v:this.lang.translate("The %1 field is required.",elemName)):v.constructor==Object?(v.value!=undefined&&(condVal=v.value),v.message!=undefined&&(customMsg=v.message)):v.constructor==String&&(customMsg=v),this.validators.push([obj.type,obj.name,obj.value,val,condVal,customMsg])}}},isValid:function(elem){var msg=null,elemName=elem[1].indexOf("[")!=-1?elem[1].substring(0,elem[1].indexOf("[")):elem[1];elemName=elemName.replace(/_/g," ");switch(elem[3]){case"alphanum":elem[2].match(/^\w+$/)||(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is not alphanumeric.",elemName));break;case"alpha":elem[2].match(/^[a-zA-Z]+$/)||(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field must contain only characters of the alphabet.",elemName));break;case"between":var numAry=elem[4].split("|");if(parseInt(elem[2])<=parseInt(numAry[0])||parseInt(elem[2])>=parseInt(numAry[1]))msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is not between %2 and %3.",[elemName,numAry[0],numAry[1]]);break;case"email":elem[2].match(/[a-zA-Z0-9\.\-\_+%]+@[a-zA-Z0-9\-\_\.]+\.[a-zA-Z]{2,4}/)||(msg=elem[5]!=null?elem[5]:this.lang.translate("The address in the %1 field is not a valid email.",elemName));break;case"equal":elem[2]!=elem[4]&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field does not equal %2.",[elemName,elem[4]]));break;case"excluded":elem[4].indexOf(elem[2])!=-1&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The value %1 must be excluded from the %2 field.",[elem[4],elemName]));break;case"greaterthan":parseInt(elem[2])<=parseInt(elem[4])&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is not greater than %2.",[elemName,elem[4]]));break;case"included":elem[4].indexOf(elem[2])==-1&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The value %1 must be included from the %2 field.",[elem[4],elemName]));break;case"length":parseInt(elem[2].length)!=parseInt(elem[4])&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The length of the %1 field does not equal %2.",[elemName,elem[4]]));break;case"lengthbet":var numAry=elem[4].split("|");if(parseInt(elem[2].length)<=parseInt(numAry[0])||parseInt(elem[2].length)>=parseInt(numAry[1]))msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is not between %2 and %3.",[elemName,numAry[0],numAry[1]]);break;case"lengthgt":parseInt(elem[2].length)<=parseInt(elem[4])&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The length of the %1 field is not greater than %2.",[elemName,elem[4]]));break;case"lengthlt":parseInt(elem[2].length)>=parseInt(elem[4])&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The length of the %1 field is not less than %2.",[elemName,elem[4]]));break;case"lessthan":parseInt(elem[2])>=parseInt(elem[4])&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is not less than %2.",[elemName,elem[4]]));break;case"notempty":if(elem[0]=="radio"){var counter=0;for(i=0;i<this[0].elements.length;i++)this[0].elements[i].name==elem[1]&&this[0].elements[i].checked&&counter++;if(counter==0){var elemName=elem[1].indexOf("[")!=-1?elem[1].substring(0,elem[1].indexOf("[")):elem[1];msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field must be checked.",elemName.replace(/_/g," "))}}else if(elem[0]=="checkbox"){var counter=0;for(i=0;i<this[0].elements.length;i++)this[0].elements[i].name.indexOf(elem[1])!=-1&&this[0].elements[i].checked&&counter++;if(counter==0){var elemName=elem[1].indexOf("[")!=-1?elem[1].substring(0,elem[1].indexOf("[")):elem[1];msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field must be checked.",elemName.replace(/_/g," "))}}else if(elem[0]=="select-multiple"){var counter=0;for(i=0;i<this[0].elements.length;i++)if(this[0].elements[i].name.indexOf(elem[1])!=-1)for(j=0;j<this[0].elements[i].options.length;j++)this[0].elements[i].options[j].selected&&counter++;counter==0&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field must be checked.",elemName))}else elem[2].length<1&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is empty.",elemName));break;case"notequal":elem[2]==elem[4]&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field cannot equal %2.",[elemName,elem[4]]));break;case"num":isNaN(elem[2])&&(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is not a number.",elemName));break;case"regex":var regex=eval(elem[4]);elem[2].match(regex)||(msg=elem[5]!=null?elem[5]:this.lang.translate("The %1 field is not in the correct format.",elemName));break;default:msg=null}return msg},getLength:function(a){if(a.value.length==a.maxLength){var b=a.tabIndex;b<this[0].length&&this[0].elements[b].focus()}},checkValidate:function(a,b){this.lang==null&&(this.lang=window.jax.i18n());var c=this[0].elements,d=0;for(var e=0;e<c.length;e++)c[e].type=="checkbox"&&c[e].checked&&d++;return a!=null&&d==0?(alert(this.lang.translate("Please select at least one %1.",a)),!1):b!=null?confirm(this.lang.translate("This action cannot be undone. Are you sure?")):!0},checkAll:function(a,b){b!=null?b.constructor!=Array&&(b=[b]):b=[];var c=this[0].elements;if(a==null){for(var d=0;d<c.length;d++)if(c[d].type=="checkbox"&&b.indexOf(c[d].value)==-1)c[d].checked||(c[d].checked=!0);else if(c[d].nodeName=="SELECT"&&c[d].multiple){opts=c[d].getElementsByTagName("option");for(j=0;j<opts.length;j++)!opts[j].selected&&b.indexOf(opts[j].value)==-1&&(opts[j].selected=!0)}}else for(var d=0;d<c.length;d++)if(c[d].id.indexOf(a)!=-1||c[d].name.indexOf(a)!=-1)if(c[d].type=="checkbox"&&b.indexOf(c[d].value)==-1)c[d].checked||(c[d].checked=!0);else if(c[d].nodeName=="SELECT"&&c[d].multiple){opts=c[d].getElementsByTagName("option");for(j=0;j<opts.length;j++)!opts[j].selected&&b.indexOf(opts[j].value)==-1&&(opts[j].selected=!0)}},uncheckAll:function(a,b){b!=null?b.constructor!=Array&&(b=[b]):b=[];var c=this[0].elements;if(a==null){for(var d=0;d<c.length;d++)if(c[d].type=="checkbox"&&b.indexOf(c[d].value)==-1)c[d].checked&&(c[d].checked=!1);else if(c[d].nodeName=="SELECT"&&c[d].multiple){opts=c[d].getElementsByTagName("option");for(j=0;j<opts.length;j++)opts[j].selected&&b.indexOf(opts[j].value)==-1&&(opts[j].selected=!1)}}else for(var d=0;d<c.length;d++)if(c[d].id.indexOf(a)!=-1||c[d].name.indexOf(a)!=-1)if(c[d].type=="checkbox"&&b.indexOf(c[d].value)==-1)c[d].checked&&(c[d].checked=!1);else if(c[d].nodeName=="SELECT"&&c[d].multiple){opts=c[d].getElementsByTagName("option");for(j=0;j<opts.length;j++)opts[j].selected&&b.indexOf(opts[j].value)==-1&&(opts[j].selected=!1)}},checkInverse:function(a,b){b!=null?b.constructor!=Array&&(b=[b]):b=[];var c=this[0].elements;if(a==null){for(var d=0;d<c.length;d++)if(c[d].type=="checkbox"&&b.indexOf(c[d].value)==-1)c[d].checked=c[d].checked?!1:!0;else if(c[d].nodeName=="SELECT"&&c[d].multiple){opts=c[d].getElementsByTagName("option");for(j=0;j<opts.length;j++)b.indexOf(opts[j].value)==-1&&(opts[j].selected=opts[j].selected?!1:!0)}}else for(var d=0;d<c.length;d++)if(c[d].id.indexOf(a)!=-1||c[d].name.indexOf(a)!=-1)if(c[d].type=="checkbox"&&b.indexOf(c[d].value)==-1)c[d].checked=c[d].checked?!1:!0;else if(c[d].nodeName=="SELECT"&&c[d].multiple){opts=c[d].getElementsByTagName("option");for(j=0;j<opts.length;j++)b.indexOf(opts[j].value)==-1&&(opts[j].selected=opts[j].selected?!1:!0)}}});